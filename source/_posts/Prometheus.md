---
link: 
title: docker容器部署Prometheus服务——云平台监控利器
description: Prometheus是一个系统和服务监视系统。它以给定的时间间隔从已配置的目标收集指标，评估规则表达式，显示结果，并在发现某些情况为真时触发警报。
keywords: 容器,Docker,Node.js,网站,TCP/IP
author: 
date: 2022.11.16
publisher: null
top_img: 
stats: paragraph=38 sentences=3, words=46
---
**Prometheus**是一个系统和服务监视系统。它以给定的时间间隔从已配置的目标收集指标，评估规则表达式，显示结果，并在发现某些情况为真时触发警报。

> **与其他监视系统相比，Prometheus的主要区别特征是：**

* 一个多维数据模型（时间序列由指标名称定义和设置键/值尺寸）
* 一个灵活的查询语言来利用这一维度
* 不依赖于分布式存储；单服务器节点是自治的
* 时间序列收集通过HTTP 上的拉模型进行
* 通过中间网关支持推送时间序列
* 通过服务发现或静态配置发现目标
* 多种图形和仪表板支持模式
* 支持分层和水平联合

**其官方给出的架构示意图：**

**部署该服务，包括四个组件：Prometheus Server、Node Exporter、cAdvrisor、Grafana。**

> **各个组件的作用如下：**

* Prometheus Server：Prometheus服务的主服务器 ；
* Node Exporter：收集Host硬件和操作系统的信息；
* cAdvrisor：负责收集Host上运行的容器信息；
* Grafana：用来展示Prometheus监控操作界面（给我们提供一个友好的web界面）

以上四个组件的所有介绍，可到[Github官网](https://github.com/)，直接搜索相应的docker镜像名称（在下面的部署过程中，每运行一个服务的容器，都会指定其镜像名称，可以参考命令中的镜像名称进行搜索），即可找到到关于组件的详细介绍。 **一、环境准备**

**二、开始配置** **1、运行Node Server容器** 该组件需要运行在所有需要监控的主机上，也就是，我这里三台服务器都需要执行下面的命令，运行此容器组件

每台服务器运行上述命令后，浏览器访问docker服务器的IP地址+9100端口，能够看到以下界面，即说明容器运行没有问题。这些内容看不懂没关系，这些信息本来就不是给我们看的，我们看的是最后给我们提供的web界面。看到的网页如下：

**最好访问一下所有运行上述容器的服务器的9100端口，确保可以看到上面的页面** **2、运行cAdvisor容器** cAdvrisor是负责收集Host上运行的容器信息的，同样，在所有需要监控的服务器上执行下面的命令运行cAdvisor容器即可：

每台服务器运行上述命令后，浏览器访问服务器的IP地址+8080端口，即可看到如下页面：

**3、docker01上运行Prometheus server容器** **Prometheus Server是主服务器，所以只需要在其中一台运行此容器即可。这里我在docker01服务器上运行**

**客户端访问docker01的9090端口，会看到以下页面**

**然后单击上方的"status"--->然后点击"Targets"**

看到下面的页面，则表示至此的所有操作都没有问题

**4、docker01上运行grafana容器**

**容器运行后，即可使用客户端访问docker01IP地址+3000端口，可以看到以下页面**

在上面的登录页面，输入用户名"admin"，密码就是我们运行时指定的密码，我这里是"123.com"。输入后登录，会看到以下界面，然后单击添加数据源：

**根据下图给的提示进行修改配置**

上述配置完成后，我们就需要配置它以什么样的形式来给我们展示了，可以自定义，但是很麻烦，也选择直接去[grafana官网](https://grafana.com/)寻找现成的模板。 **登录grafana官网，点击下面的选项**

**将这些模板导入到我们grafana的web界面有两种方式**

**方式1：** **1）进入模板后，点击"Download JSON"，以便下载**

**2）下载后，回到grafana界面，点击如下**

**3）单击"Upload.json file"，然后上传我们在grafana官网下载的模板**

**4）上传后，请看下图进行操作**

**5）至此，即可看到下面的监控页面，说明导入成功了**

但是注意看的话，会发现这个模板有些信息都检测不到，所以这里只是为了展示这第一种导入模板的方式，第二种方式比较推荐 **方式2** **1）在进入官网提供的模板后，我们需要记录其ID号，如下**

**2）然后回到grafana的web界面，同样点击如下，进行导入操作**

**3）在下面的红框中输入我们记录的ID号即可**

**4）接下来的操作和方式1中的一样**

**5）导入此模板后，会看到该模板给我们提供的界面**

**至此，web界面的监控就部署完成了** **5、设置Prometheus告警** Prometheus的告警方式有好几种方式，邮箱、钉钉、微信等，我这里选择邮箱的告警方式 **1）docker01服务器上运行alertmanager容器**

**2）设置alertmanager报警规则**

**至此，如果Prometheus页面中的target有down掉的容器，那么就会给你的邮箱发送报警信息。当容器正常后，它还会给你反馈**

**我收到的报警邮件如下**

**4）设置报警信息模板**

至此，新的报警模板也生成了，如果以下容器有Down的，就会给你发送新的邮件，恢复正常后，也会发送邮件，同样，邮件中的内容格式是有误的，但是你可以正常接收到报警信息，若想要更改其报警模板，可以参考[github官方文档](https://github.com/prometheus/alertmanager/blob/master/template/email.html) **我收到的报警信息如下**
